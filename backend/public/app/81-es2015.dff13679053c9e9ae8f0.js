(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{BRkQ:function(t,e,a){"use strict";a.r(e),a.d(e,"StokOpnameModule",function(){return H});var i=a("ofXK"),o=a("tyNb"),n=a("7zfz"),l=a("wd/R"),r=a("EUZL"),s=a("fXoL"),d=a("EJUL"),c=a("U+s4"),b=a("G0w9"),p=a("ujBT"),u=a("Nf9I"),h=a("arFO"),m=a("3Pt+"),g=a("7kUa"),k=a("jIHw"),P=a("xlun"),f=a("rEr+"),Q=a("Q4Mo"),S=a("NCSE");const x=["fileUpload"];function J(t,e){if(1&t){const t=s.Sb();s.Qb(0,"button",30),s.Yb("click",function(){return s.yc(t),s.bc(2).reset()}),s.Pb()}}function v(t,e){if(1&t){const t=s.Sb();s.Qb(0,"div",24),s.Qb(1,"button",25),s.Yb("click",function(){return s.yc(t),s.bc().exportExcel()}),s.Pb(),s.Qb(2,"p-fileUpload",26,27),s.Yb("onUpload",function(e){return s.yc(t),s.bc().onBasicUpload(e)})("onSelect",function(e){return s.yc(t),s.bc().onSelect(e)}),s.Pb(),s.Hc(4,J,1,0,"button",28),s.Qb(5,"button",29),s.Yb("click",function(){return s.yc(t),s.bc().daftarSo()}),s.Pb(),s.Pb()}if(2&t){const t=s.bc();s.xb(4),s.ic("ngIf",null!=t.item.namaFile)}}function w(t,e){1&t&&(s.Qb(0,"tr"),s.Qb(1,"th",31),s.Jc(2,"Kode Produk"),s.Pb(),s.Qb(3,"th",31),s.Jc(4,"Nama Produk"),s.Pb(),s.Qb(5,"th",32),s.Jc(6,"Saldo"),s.Pb(),s.Qb(7,"th",31),s.Jc(8,"Satuan"),s.Pb(),s.Pb(),s.Qb(9,"tr"),s.Qb(10,"th"),s.Jc(11,"Sistem"),s.Pb(),s.Qb(12,"th"),s.Jc(13,"Real"),s.Pb(),s.Qb(14,"th"),s.Jc(15,"Selisih"),s.Pb(),s.Pb())}function R(t,e){if(1&t){const t=s.Sb();s.Qb(0,"input",36),s.Yb("ngModelChange",function(e){return s.yc(t),s.bc().$implicit.stokReal=e})("input",function(){s.yc(t);const e=s.bc().$implicit;return s.bc().onChange(e,e.stokReal)}),s.Pb()}if(2&t){const t=s.bc().$implicit;s.ic("ngModel",t.stokReal)}}function y(t,e){if(1&t&&s.Jc(0),2&t){const t=s.bc().$implicit;s.Lc(" ",t.stokReal," ")}}function C(t,e){if(1&t&&(s.Qb(0,"tr"),s.Qb(1,"td"),s.Jc(2),s.Pb(),s.Qb(3,"td"),s.Jc(4),s.Pb(),s.Qb(5,"td"),s.Jc(6),s.Pb(),s.Qb(7,"td",33),s.Qb(8,"p-cellEditor"),s.Hc(9,R,1,1,"ng-template",34),s.Hc(10,y,1,1,"ng-template",35),s.Pb(),s.Pb(),s.Qb(11,"td"),s.Jc(12),s.Pb(),s.Qb(13,"td"),s.Jc(14),s.Pb(),s.Pb()),2&t){const t=e.$implicit;s.xb(2),s.Kc(t.kodeProduk),s.xb(2),s.Kc(t.namaProduk),s.xb(2),s.Kc(t.qtyProduk),s.xb(1),s.ic("ngClass","row-header"),s.xb(5),s.Kc(t.selisih),s.xb(2),s.Kc(t.satuanStandar)}}function T(t,e){if(1&t){const t=s.Sb();s.Qb(0,"div",24),s.Qb(1,"button",38),s.Yb("click",function(){return s.yc(t),s.bc(2).exportExcel2()}),s.Pb(),s.Pb()}}function B(t,e){1&t&&(s.Qb(0,"tr"),s.Qb(1,"th",31),s.Jc(2,"Kode Produk"),s.Pb(),s.Qb(3,"th",31),s.Jc(4,"Nama Produk"),s.Pb(),s.Qb(5,"th",32),s.Jc(6,"Saldo"),s.Pb(),s.Qb(7,"th",31),s.Jc(8,"Satuan"),s.Pb(),s.Pb(),s.Qb(9,"tr"),s.Qb(10,"th"),s.Jc(11,"Sistem"),s.Pb(),s.Qb(12,"th"),s.Jc(13,"Real"),s.Pb(),s.Qb(14,"th"),s.Jc(15,"Selisih"),s.Pb(),s.Pb())}function M(t,e){if(1&t&&(s.Qb(0,"tr"),s.Qb(1,"td"),s.Jc(2),s.Pb(),s.Qb(3,"td"),s.Jc(4),s.Pb(),s.Qb(5,"td"),s.Jc(6),s.Pb(),s.Qb(7,"td"),s.Jc(8),s.Pb(),s.Qb(9,"td"),s.Jc(10),s.Pb(),s.Qb(11,"td"),s.Jc(12),s.Pb(),s.Pb()),2&t){const t=e.$implicit;s.xb(2),s.Kc(t.kodeProduk),s.xb(2),s.Kc(t.namaProduk),s.xb(2),s.Kc(t.qtyProduk),s.xb(2),s.Kc(t.stokReal),s.xb(2),s.Kc(t.selisih),s.xb(2),s.Kc(t.satuanStandar)}}function K(t,e){if(1&t&&(s.Qb(0,"div",4),s.Qb(1,"div",3),s.Qb(2,"p-table",37),s.Hc(3,T,2,0,"ng-template",17),s.Hc(4,B,16,0,"ng-template",18),s.Hc(5,M,13,6,"ng-template",19),s.Pb(),s.Pb(),s.Pb()),2&t){const t=s.bc();s.xb(2),s.ic("value",t.dataSourceTeuAya)}}const j=function(t){return[t]},D=[{path:"",component:(()=>{class t{constructor(t,e,a,i,o,n,l,r,s){this.apiService=t,this.authService=e,this.confirmationService=a,this.messageService=i,this.cacheHelper=o,this.helper=n,this.alertService=l,this.route=r,this.state=s,this.item={},this.isSimpan=!0,this.totalRecords=0}ngOnInit(){this.dataLogin=this.authService.getDataLoginUser(),this.kelUser=this.dataLogin.kelompokUser.kelompokUser,this.dateNow=new Date,this.item.jmlRows=10,this.column=[{field:"no",header:"No",width:"65px"},{field:"noTerima",header:"No Terima",width:"140px"},{field:"kodeProduk",header:"Kode Produk",width:"140px"},{field:"namaProduk",header:"Nama Produk",width:"300px"},{field:"asalProduk",header:"Asal Produk",width:"180px"},{field:"qtyProduk",header:"Stok",width:"120px"},{field:"qtyOnHand",header:"Stok Onhand",width:"140px"},{field:"qtyorder",header:"Stok Order",width:"140px"},{field:"satuanStandar",header:"Satuan",width:"120px"},{field:"tglKadaluarsa",header:"Tgl Exp",width:"140px"},{field:"harga",header:"Harga",width:"140px",isCurrency:!0},{field:"noBatch",header:"No Batch",width:"140px"}],this.loadDataCombo()}loadDataCombo(){this.apiService.get("logistik/get-combo-logistik").subscribe(t=>{this.listRuangan=null!=this.dataLogin.mapLoginUserToRuangan?this.dataLogin.mapLoginUserToRuangan:t.ruangfarmasi,this.item.dataRuangan=this.listRuangan[0]}),this.apiService.get("logistik/get-combo-detailjenisproduk").subscribe(t=>{this.listDetailJenisProduk=t.detailjenisproduk})}isiJenisProduk(){null!=this.item.dataDjenisProduk&&(this.listJenisBarang=this.item.dataDjenisProduk.jenisproduk)}isiKelompokProduk(){null!=this.item.dataJenisBarang&&(this.listKelompokBarang=this.item.dataJenisBarang.kelompokproduk)}formatRupiah(t,e){return e+" "+parseFloat(t).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")}loadData(){var t,e,a,i,o;i="",null!=this.item.dataRuangan&&(i=this.item.dataRuangan.id),t="",null!=this.item.dataDjenisProduk&&(t=this.item.dataDjenisProduk.id),e="",null!=this.item.dataKelompokBarang&&(e=this.item.dataKelompokBarang.id),a="",null!=this.item.dataJenisBarang&&(a=this.item.dataJenisBarang.id),o="",null!=this.item.namaProduk&&(o=this.item.namaProduk);var n="";null!=this.item.jmlRows&&(n=this.item.jmlRows),this.dataTable=[],this.apiService.get("logistik/get-stok-ruangan-so?kelompokprodukid="+e+"&detailJenisProdukId="+t+"&jeniskprodukid="+a+"&namaproduk="+o+"&ruanganfk="+i+"&jmlRows="+n).subscribe(t=>{var e=t.detail;for(let a=0;a<e.length;a++){const t=e[a];t.stokReal=t.qtyProduk}this.totalRecords=e.length,this.dataTable=e})}cari(){this.loadData()}onChange(t,e){t.selisih=e-t.qtyProduk}save(){if(null!=this.item.dataRuangan){for(var t=[],e=this.dataTable.length-1;e>=0;e--)null!=this.dataTable[e].selisih&&t.push({produkfk:this.dataTable[e].kodeProduk,stokSistem:this.dataTable[e].qtyProduk,stokReal:this.dataTable[e].stokReal,selisih:this.dataTable[e].selisih});if(0!==t.length){var a={ruanganId:this.item.dataRuangan.id,namaRuangan:this.item.dataRuangan.namaruangan,tglClosing:l(new Date).format("YYYY-MM-DD HH:mm:ss"),stokProduk:t};this.isSimpan=!1,this.apiService.post("logistik/save-data-stock-opname",a).subscribe(t=>{this.isSimpan=!0;var e=t.noSO;null!=e&&this.apiService.postLog("Stok Opname","norec Struk Closing",e.norec,"Stok Opname dengan No Closing "+e.noclosing+" di ruangan "+this.item.dataRuangan.namaruangan).subscribe(t=>{});for(var a=t.databarangtaktersave,i=a.length-1;i>=0;i--)a[i].no=i+1;this.isTeuAya=a.length>0,this.dataSourceTeuAya=a,this.cancel(),this.cari()},t=>{this.isSimpan=!0})}else this.alertService.error("Info","Saldo Real barang belum di isi")}else this.alertService.warn("Info","Pilih ruangan dulu")}exportExcel(){this.helper.exportExcel(this.dataTable,"StokOpname")}exportExcel2(){this.helper.exportExcel(this.dataTable,"StokOpnameGagal")}onSelect(t,e){let a=null,i=null;const o=new FileReader,n=t.files[0];this.item.namaFile=n,o.onload=t=>{a=r.read(o.result,{type:"binary"}),i=a.SheetNames.reduce((t,e)=>(t[e]=r.utils.sheet_to_json(a.Sheets[e]),t),{}),JSON.stringify(i),this.dataImport=i;let e={data:i.data,ruanganfk:this.item.dataRuangan.id};this.dataTable=[],this.apiService.post("logistik/get-stok-ruangan-so-from-fileexcel",e).subscribe(t=>{this.isSimpan=t.save_cmd,this.dataTable=t.detail,this.totalRecords=this.dataTable.length})},o.readAsBinaryString(n)}reset(){this.totalRecords=0,this.fileUpload.clear()}cancel(){this.totalRecords=0,this.fileUpload.clear(),this.item.namaFile=void 0}daftarSo(){this.state.navigate(["daftar-so"])}}return t.\u0275fac=function(e){return new(e||t)(s.Jb(d.a),s.Jb(d.b),s.Jb(n.a),s.Jb(n.h),s.Jb(c.a),s.Jb(b.a),s.Jb(p.a),s.Jb(o.a),s.Jb(o.f))},t.\u0275cmp=s.Db({type:t,selectors:[["app-stok-opname"]],viewQuery:function(t,e){if(1&t&&s.Nc(x,!0),2&t){let t;s.vc(t=s.Zb())&&(e.fileUpload=t.first)}},features:[s.wb([n.a])],decls:42,vars:26,consts:[["header","Confirmation","icon","fa fa-question-circle"],[1,"p-fluid","p-formgrid"],[1,"card","card-w-title"],[1,"p-col-12","p-md-12"],[1,"p-grid"],[1,"p-col-12","p-md-2"],["for","input",1,"label"],["placeholder","Ruangan","optionLabel","namaruangan",3,"options","ngModel","filter","showClear","ngModelChange"],["placeholder","Detail Jenis Produk","optionLabel","detailjenisproduk",3,"options","ngModel","filter","showClear","ngModelChange","onChange"],["placeholder","Jenis Produk","optionLabel","jenisproduk",3,"options","ngModel","filter","showClear","ngModelChange","onChange"],["placeholder","Kelompok Produk","optionLabel","kelompokproduk",3,"options","ngModel","filter","showClear","ngModelChange"],[1,"p-col-12","p-md-3"],["type","text","pInputText","","placeholder","Nama Barang",3,"ngModel","ngModelChange","keyup.enter"],[1,"p-col-12","p-md-1"],[1,"p-col-12","p-md-12",2,"margin-top","10px"],["pButton","","type","submit","icon","pi pi-search","pTooltip","Cari",3,"click"],["dataKey","kodeProduk","totalRecords","totalRecords","currentPageReportTemplate","Showing 1 to {totalRecords} of {totalRecords} entries",3,"value","paginator","showCurrentPageReport","rows","rowsPerPageOptions"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"p-col-12","p-md-1","p-md-offset-10"],["pButton","","type","submit","icon","pi pi-save","label","Simpan","pTooltip","Simpan Stok Opname",1,"p-button-success",3,"disabled","click"],["pButton","","type","submit","icon","fa fa-refresh","label","Batal","pTooltip","Reset Data",1,"p-button-danger",3,"click"],["class","p-grid",4,"ngIf"],[1,"p-d-flex"],["type","button","pButton","","pRipple","","icon","pi pi-file-excel","pTooltip","Export Excel","tooltipPosition","bottom",1,"p-button-success","p-mr-2",3,"click"],["mode","basic","name","demo[]","chooseLabel","Import","maxFileSize","1000000","pTooltip","Import File sesuai data Excel yang di Export dari Table Ini",1,"p-mr-2",3,"onUpload","onSelect"],["fileUpload",""],["pButton","","pRipple","","icon","pi pi-undo","class","p-button-danger p-button-success","pTooltip","Reset File Upload","label","",3,"click",4,"ngIf"],["type","button","pButton","","pRipple","","icon","pi pi-sliders-h","pTooltip","Daftar Stok Opname","tooltipPosition","bottom",1,"p-button-warning","p-mr-2",3,"click"],["pButton","","pRipple","","icon","pi pi-undo","pTooltip","Reset File Upload","label","",1,"p-button-danger","p-button-success",3,"click"],["rowspan","2"],["colspan","3",2,"text-align","center"],["pEditableColumn","",3,"ngClass"],["pTemplate","input"],["pTemplate","output"],["pInputText","","type","number","required","",3,"ngModel","ngModelChange","input"],["dataKey","isTeuAya",3,"value"],["type","button","pButton","","pRipple","","icon","pi pi-file-excel","pTooltip","XLS","tooltipPosition","bottom",1,"p-button-success","p-mr-2",3,"click"]],template:function(t,e){1&t&&(s.Lb(0,"p-confirmDialog",0),s.Qb(1,"div",1),s.Qb(2,"div",2),s.Qb(3,"h4"),s.Jc(4,"Stok Opname"),s.Pb(),s.Qb(5,"div",3),s.Qb(6,"div",4),s.Qb(7,"div",5),s.Qb(8,"label",6),s.Jc(9,"Ruangan"),s.Pb(),s.Qb(10,"p-dropdown",7),s.Yb("ngModelChange",function(t){return e.item.dataRuangan=t}),s.Pb(),s.Pb(),s.Qb(11,"div",5),s.Qb(12,"label",6),s.Jc(13,"Detail Jenis Produk"),s.Pb(),s.Qb(14,"p-dropdown",8),s.Yb("ngModelChange",function(t){return e.item.dataDjenisProduk=t})("onChange",function(){return e.isiJenisProduk()}),s.Pb(),s.Pb(),s.Qb(15,"div",5),s.Qb(16,"label",6),s.Jc(17,"Jenis Produk"),s.Pb(),s.Qb(18,"p-dropdown",9),s.Yb("ngModelChange",function(t){return e.item.dataJenisBarang=t})("onChange",function(){return e.isiKelompokProduk()}),s.Pb(),s.Pb(),s.Qb(19,"div",5),s.Qb(20,"label",6),s.Jc(21,"Kelompok Produk"),s.Pb(),s.Qb(22,"p-dropdown",10),s.Yb("ngModelChange",function(t){return e.item.dataKelompokBarang=t}),s.Pb(),s.Pb(),s.Qb(23,"div",11),s.Qb(24,"label",6),s.Jc(25,"Nama Produk"),s.Pb(),s.Qb(26,"input",12),s.Yb("ngModelChange",function(t){return e.item.namaProduk=t})("keyup.enter",function(){return e.cari()}),s.Pb(),s.Pb(),s.Qb(27,"div",13),s.Qb(28,"div",14),s.Qb(29,"button",15),s.Yb("click",function(){return e.cari()}),s.Pb(),s.Pb(),s.Pb(),s.Pb(),s.Pb(),s.Qb(30,"div",3),s.Qb(31,"p-table",16),s.Hc(32,v,6,1,"ng-template",17),s.Hc(33,w,16,0,"ng-template",18),s.Hc(34,C,15,6,"ng-template",19),s.Pb(),s.Pb(),s.Qb(35,"div",3),s.Qb(36,"div",4),s.Qb(37,"div",20),s.Qb(38,"button",21),s.Yb("click",function(){return e.save()}),s.Pb(),s.Pb(),s.Qb(39,"div",13),s.Qb(40,"button",22),s.Yb("click",function(){return e.cancel()}),s.Pb(),s.Pb(),s.Pb(),s.Hc(41,K,6,1,"div",23),s.Pb(),s.Pb(),s.Pb()),2&t&&(s.xb(10),s.ic("options",e.listRuangan)("ngModel",e.item.dataRuangan)("filter",!0)("showClear",!0),s.xb(4),s.ic("options",e.listDetailJenisProduk)("ngModel",e.item.dataDjenisProduk)("filter",!0)("showClear",!0),s.xb(4),s.ic("options",e.listJenisBarang)("ngModel",e.item.dataJenisBarang)("filter",!0)("showClear",!0),s.xb(4),s.ic("options",e.listKelompokBarang)("ngModel",e.item.dataKelompokBarang)("filter",!0)("showClear",!0),s.xb(4),s.ic("ngModel",e.item.namaProduk),s.xb(5),s.ic("value",e.dataTable)("paginator",!0)("showCurrentPageReport",!1)("rows",e.totalRecords)("rowsPerPageOptions",s.nc(24,j,e.totalRecords)),s.xb(7),s.ic("disabled",!e.isSimpan),s.xb(3),s.ic("ngIf",e.isTeuAya))},directives:[u.a,h.a,m.g,m.h,m.a,g.a,k.b,P.a,f.h,n.k,i.l,Q.a,S.a,f.c,i.j,f.a,m.i,m.k],styles:["[_nghost-%COMP%]     .row-header{background-color:rgba(0,0,0,.15)!important}"]}),t})()}];let U=(()=>{class t{}return t.\u0275mod=s.Hb({type:t}),t.\u0275inj=s.Gb({factory:function(e){return new(e||t)},imports:[[o.j.forChild(D)],o.j]}),t})();var L=a("PCNd");let H=(()=>{class t{}return t.\u0275mod=s.Hb({type:t}),t.\u0275inj=s.Gb({factory:function(e){return new(e||t)},imports:[[i.b,U,L.a]]}),t})()}}]);